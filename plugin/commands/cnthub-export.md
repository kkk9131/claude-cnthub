---
name: cnthub:export
description: 現在のセッションの観測をエクスポート
---

# /cnthub:export

現在のセッションの観測を論理グループに分類し、新規セッションとしてエクスポートする。

## MCP ツール

- `list_observations` - 観測一覧取得 (`sessionId: "current"`)
- `export_observations` - グループをエクスポート
- `save_pending_context` - 残りコンテキストを保存（自動復元用）

## 重要ルール

**絶対にユーザーの選択なしでエクスポートしてはならない。**

- グループを表示した後、必ず `AskUserQuestion` でユーザーに選択させること
- 自動でグループを選択してエクスポートすることは禁止
- ユーザーが明示的に選択するまで `export_observations` を呼び出さない

## ワークフロー

1. 現在のセッションから観測を取得
2. 論理グループに分類して表示
3. **[必須]** `AskUserQuestion` でユーザーにグループを選択させる
4. ユーザーが選択したグループのみをエクスポート
5. コンテキスト削除の確認

## 出力フォーマット

### グループ表示

```markdown
## エクスポート: 現在のセッション観測

{N}件の観測を分析し、{M}個のグループを特定しました:

### 検出されたグループ

1. **{グループ名}** ({N}件の観測)
   - {観測ID}: {説明}

2. **{グループ名}** ({N}件の観測)
   - {観測ID}: {説明}

...
```

### ユーザー選択 (必須)

グループ表示の後、必ず `AskUserQuestion` ツールでユーザーに選択させる:

```
AskUserQuestion({
  questions: [{
    question: "エクスポートするグループを選択してください",
    header: "グループ選択",
    options: [
      { label: "1. {グループ名}", description: "{N}件の観測" },
      { label: "2. {グループ名}", description: "{N}件の観測" },
      { label: "すべて", description: "全グループをエクスポート" },
      { label: "キャンセル", description: "エクスポートしない" }
    ],
    multiSelect: true
  }]
})
```

**注意**: テキストで「選択してください」と書くだけでは不十分。必ず `AskUserQuestion` ツールを呼び出すこと。

### エクスポート完了

```markdown
## エクスポート完了

{N}グループを新規セッションとしてエクスポートしました:

### 1. {グループ名}
- **セッションID**: ch_ss_XXXX
- **観測数**: X件
- **要約**: {AI生成の要約}

---

`/clear` 後に `/cnthub:get last` で素早く取得できます。
```

### コンテキスト管理確認

```markdown
## コンテキスト管理

エクスポートした観測をコンテキストから削除しますか？ (yes/no)

- **yes**: 残りのコンテキストを保存し、`/clear` 後に自動復元
- **no**: 現在のコンテキストを維持（コピーのみ）
```

### コンテキスト保存完了 (はい)

```markdown
## コンテキスト保存完了

残りのコンテキスト（{N}件の観測）を保存しました。

**次のステップ:**
1. `/clear` でコンテキストをリセット
2. 次のメッセージで残りのコンテキストが自動復元されます

`/clear` 後に `/cnthub:get last` でエクスポートしたセッションを取得できます。
```

### エクスポートのみ (いいえ)

```markdown
## エクスポート完了

観測を新規セッションにコピーしました。現在のコンテキストは変更されていません。
```

## コンテキスト保存

「はい」選択時、`save_pending_context` MCP ツールを使用:

```
save_pending_context({ context: "<formatted_remaining_context>" })
```

これにより、`/clear` 後の次のメッセージで残りのコンテキストが自動注入される。

## エラー

- 観測なし: 「現在のセッションに観測がありません。」
- API利用不可: 「cnthub APIが利用できません。」
- エクスポート失敗: 「グループ '{名前}' のエクスポートに失敗しました。」
- キャンセル: 「エクスポートをキャンセルしました。」

# 要件定義書

## プロジェクト概要

**プロジェクト名**: claude-cnthub
**目的**: Claude Code のセッション管理と AI メモリ機能を統合した開発支援ツール

---

## 背景と課題

### 現状の課題

1. Claude Code のセッションは独立しており、過去の文脈が引き継がれない
2. 複数セッションの管理が煩雑
3. 過去のセッションで学んだことを再利用できない
4. プロジェクト横断での知識蓄積ができない

### 解決策

CCB の UI 管理機能と claude-mem の AI メモリ機能を統合

---

## デプロイ形態

### 対応する3つの利用形態

| 形態                       | 説明                                   | ユースケース             |
| -------------------------- | -------------------------------------- | ------------------------ |
| **ローカルスタンドアロン** | ローカル PC で完結                     | 個人開発、オフライン利用 |
| **Git Cron 連携**          | Git 操作をトリガーに自動実行           | CI/CD 連携、自動要約     |
| **Claude Plugin**          | `claude plugin install` でインストール | 最も簡単な導入方法       |

### Claude Agent SDK 利用方式

| 方式               | 対象ユーザー               | 設定                   |
| ------------------ | -------------------------- | ---------------------- |
| **サブスクプラン** | Claude Pro/Team/Enterprise | 追加設定不要           |
| **API キー**       | API 直接利用者             | ANTHROPIC_API_KEY 設定 |

---

## 機能要件

### F1: セッション管理

| ID   | 機能             | 優先度 | 説明                                 |
| ---- | ---------------- | ------ | ------------------------------------ |
| F1.1 | セッション作成   | 必須   | 名前、作業ディレクトリ、タスクを指定 |
| F1.2 | セッション一覧   | 必須   | 全セッションをリスト表示             |
| F1.3 | セッション再開   | 必須   | --resume オプションで再開            |
| F1.4 | セッション削除   | 必須   | 不要なセッションを削除               |
| F1.5 | 同時実行         | 必須   | 最大10セッション並行実行             |
| F1.6 | リアルタイム表示 | 必須   | WebSocket でリアルタイム表示         |

### F2: セッション要約（AI）

| ID   | 機能           | 優先度 | 説明                                     |
| ---- | -------------- | ------ | ---------------------------------------- |
| F2.1 | 自動要約       | 必須   | セッション終了時に自動生成               |
| F2.2 | 手動要約       | 任意   | 任意タイミングでトリガー                 |
| F2.3 | 要約表示       | 必須   | 短縮版/詳細版を表示                      |
| F2.4 | メタデータ抽出 | 必須   | 決定事項、変更ファイル、ツール使用を抽出 |

### F3: セマンティック検索

| ID   | 機能           | 優先度 | 説明                        |
| ---- | -------------- | ------ | --------------------------- |
| F3.1 | 自然言語検索   | 必須   | 日本語/英語で検索           |
| F3.2 | 関連度スコア   | 必須   | 検索結果にスコア表示        |
| F3.3 | フィルタリング | 任意   | プロジェクト/期間でフィルタ |

### F4: コンテキスト注入

| ID   | 機能               | 優先度 | 説明                                           |
| ---- | ------------------ | ------ | ---------------------------------------------- |
| F4.1 | 自動注入           | 必須   | 新セッション開始時に関連コンテキスト注入       |
| F4.2 | プログレッシブ開示 | 必須   | 約800トークンのインデックス + オンデマンド詳細 |
| F4.3 | 注入プレビュー     | 任意   | 事前確認可能                                   |

### F5: 進捗トラッキング

| ID   | 機能           | 優先度 | 説明                          |
| ---- | -------------- | ------ | ----------------------------- |
| F5.1 | Work Item 管理 | 必須   | タスクを Work Item として管理 |
| F5.2 | 進捗分析       | 必須   | AI が進捗を分析               |
| F5.3 | レポート生成   | 任意   | 進捗レポート生成              |

### F6: プラグイン/Hook 連携

| ID   | 機能               | 優先度 | 説明                                       |
| ---- | ------------------ | ------ | ------------------------------------------ |
| F6.1 | Claude Plugin 対応 | 必須   | `claude plugin install` でインストール可能 |
| F6.2 | Hook サーバー      | 必須   | 外部 Claude Code からのフック受信          |
| F6.3 | Git Cron 対応      | 必須   | Git 操作トリガーで自動実行                 |
| F6.4 | 設定生成           | 必須   | hooks.json 設定を自動生成                  |

---

## 非機能要件

### NF1: パフォーマンス

| ID    | 要件           | 目標値            |
| ----- | -------------- | ----------------- |
| NF1.1 | API レスポンス | 95% が 200ms 以内 |
| NF1.2 | 検索レスポンス | 500ms 以内        |
| NF1.3 | 要約生成       | 30秒以内          |

### NF2: 信頼性

| ID    | 要件                         | 説明                          |
| ----- | ---------------------------- | ----------------------------- |
| NF2.1 | データ永続化                 | SQLite でローカル保存         |
| NF2.2 | グレースフルデグラデーション | AI 処理失敗時もセッション継続 |

### NF3: 互換性

| ID    | 要件                   | 説明                    |
| ----- | ---------------------- | ----------------------- |
| NF3.1 | マルチプラットフォーム | macOS / Windows / Linux |
| NF3.2 | Claude Agent SDK       | サブスク/API キー両対応 |
| NF3.3 | Plugin 互換            | Claude Plugin 仕様準拠  |

---

## 制約事項

1. **ランタイム**: Bun 1.0.0 以上
2. **AI**: Claude Agent SDK（サブスク or API キー）
3. **ストレージ**: SQLite（ローカル）
4. **ネットワーク**: ローカル専用（公開非対応）

---

## 用語定義

| 用語              | 定義                                     |
| ----------------- | ---------------------------------------- |
| Session           | Claude Code との1回の対話                |
| Summary           | AI 生成のセッション要約                  |
| Context Injection | 関連情報の自動注入                       |
| Work Item         | 複数セッションをまとめるタスク単位       |
| Hook              | Claude Code ライフサイクルイベントの捕捉 |
| Plugin            | Claude Code の拡張機能                   |
